"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[831],{7835:function(e,t,n){n.a(e,(async function(e,i){try{n(7658);var l=n(3396),o=n(9242),r=n(4870),u=n(2483),a=n(7877),s=n(227),c=n(5174),v=n(9686),m=e([a]);a=(m.then?(await m)():m)[0];const d=["src"],g=["onKeyup"],h="CreamPlayer",f="Setting",y="playTheme",p="darkTheme";t.Z={__name:"Play",props:{songid:[String,Number],title:[String,Number],artist:[String,Number],album:[String,Number],cover:[String,Number],publishTime:[String,Number]},setup(e){const t=e,n=(0,u.tv)();console.log(t);const i=(0,r.iH)(1),m=(0,r.iH)(!1),w=(0,r.iH)(""),b=(0,r.iH)([]),k=(0,r.iH)(null),S=(0,r.iH)(0),x=(0,r.iH)(!1),H=(0,s.A)(),T=H.lastSearch;function _(){n.push({name:"search",params:{q:T}})}function N(e){const t=e.split("\n"),n=/\[(\d{2}):(\d{2})\.?(\d{2,3})?\](.*)/;return t.map((e=>{const t=n.exec(e);if(t){const e=t[1],n=t[2],i="0."+t[3]||0,l=60*parseInt(e)+parseFloat(n)+parseFloat(i);return{time:l,text:t[4]}}return""!=e?{time:777404,text:e}:e}))}function C(e){" "===e.key?(e.preventDefault(),k.value.paused?k.value.play():k.value.pause()):"ArrowUp"===e.key?(e.preventDefault(),H.increaseVolume(),k.value.volume=H.volume,console.log(H.volume)):"ArrowDown"===e.key?(e.preventDefault(),H.decreaseVolume(),k.value.volume=H.volume,console.log(H.volume)):"ArrowLeft"===e.key?k.value.currentTime-=3:"ArrowRight"===e.key&&(k.value.currentTime+=3)}function L(e){(0,c.xz)(h,f,y,i,e),console.log("Setting")}console.log(T),console.log(H.volume),(0,l.bv)((async()=>{(0,c.Xx)(h,f,y,i),await(0,c.Xx)(h,f,p,m),m.value&&!document.body.classList.contains("dark")&&document.body.classList.toggle("dark"),a.ZP.getSongUrl(t.songid).then((e=>{try{if(w.value=e["data"][0]["url"],!w.value)throw new Error}catch(t){console.log("fail load song url"),x.value=!0}})),a.ZP.getSongLyrics(t.songid).then((e=>{const t=N(e.lrc.lyric);null==t[0].time?b.value=[{time:0,text:t}]:b.value=t})),window.addEventListener("keydown",C),k.value.volume=H.volume})),(0,l.Ah)((()=>{window.removeEventListener("keydown",C)}));const D=()=>{if(!k.value)return;const e=k.value.currentTime;for(const t of b.value)e>=t.time&&(S.value=t.time)},A=(0,r.iH)(null),Z=(0,r.iH)(null);async function E(){console.log(Z.value),await(0,c.d8)(Z.value),location.reload()}function P(){A.value.focus()}return(t,n)=>((0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",{class:"left-return",title:"返回",onClick:_}),(0,l._)("audio",{id:"audio",class:"audio",ref_key:"audio",ref:k,src:w.value,onTimeupdate:D,autoplay:"",loop:""},null,40,d),x.value?((0,l.wg)(),(0,l.iD)("div",{key:0,class:"isVip",onClick:P},[(0,l.wy)((0,l._)("input",{class:"cookie-input",placeholder:"VIP Cookie","onUpdate:modelValue":n[0]||(n[0]=e=>Z.value=e),onKeyup:(0,o.D2)(E,["enter"]),autofocus:"",ref_key:"inputRef",ref:A},null,40,g),[[o.nr,Z.value]])])):((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[1==i.value?((0,l.wg)(),(0,l.j4)(v.Z,{key:0,songUrl:w.value,songLyrics:b.value,title:e.title,artist:e.artist,album:e.album,cover:e.cover,publishTime:e.publishTime,onSwitch:L,onReturn:_,audio:k.value,currentHighlight:S.value},null,8,["songUrl","songLyrics","title","artist","album","cover","publishTime","audio","currentHighlight"])):(0,l.kq)("",!0)],64))],64))}},i()}catch(d){i(d)}}))},227:function(e,t,n){n.d(t,{A:function(){return l}});var i=n(1020);const l=(0,i.Q_)("counter",{state:()=>({lastSearch:"",volume:.7}),persist:{enabled:!0,strategies:[{key:"lastSearch",storage:localStorage},{key:"volume",storage:localStorage}]},actions:{setLastSearch(e){this.lastSearch=e},increaseVolume(){this.volume=Math.min(1,this.volume+.1),this.volume=Math.round(10*this.volume)/10},decreaseVolume(){this.volume=Math.max(0,this.volume-.1),this.volume=Math.round(10*this.volume)/10}}})},9686:function(e,t,n){n.d(t,{Z:function(){return v}});n(7658);var i=n(3396),l=n(7139),o=n(4870);const r={class:"player"},u=["onClick"];var a={__name:"1",props:{songUrl:[String,Number],songLyrics:Array,title:[String,Number],artist:[String,Number],album:[String,Number],cover:[String,Number],publishTime:[String,Number],audio:HTMLAudioElement,currentHighlight:[String,Number]},emits:["switch","return"],setup(e,{emit:t}){const n=e,a=(0,o.iH)([]),s=(0,o.iH)(null);function c(e){if(!e.text)return"3vw";if(/^\s+$/.test(e.text))return"14px";const t=window.innerWidth+"px";let n=1;while(1){if(n>=40)return String(n)+"vw";const i=String(n)+"vw",l=v(e.text,i,t);if(l)return String(n-1.1)+"vw";n++}}function v(e,t,n){const i=document.createElement("div");i.style.fontSize=t,i.style.maxWidth=n,i.innerText=e,i.style.fontFamily="'SuperBlack', Arial, sans-serif",i.style.overflowWrap="anywhere",i.style.whiteSpace="pre",document.body.appendChild(i);const l=i.scrollWidth>i.clientWidth;return document.body.removeChild(i),l}function m(e){777404!=e.time&&(n.audio.currentTime=e.time)}return(0,i.bv)((async()=>{function e(e){let t=!0;return e.value.map((e=>{if(t){if(""==e||e.text.includes(":")||e.text.includes("：")||e.text.includes("-")||e.text.includes("(")||e.text.includes("（")||e.text.includes("《"))return!1;t=!1}return e}))}(0,i.YP)((()=>n.currentHighlight),((e,t)=>{(0,i.Y3)((()=>{try{const e=document.getElementsByClassName("active")[0],t=e.offsetTop;console.log(t);const n=document.documentElement.clientHeight,i=e.offsetTop-n/2+e.clientHeight/2;document.documentElement.scrollTop=i}catch(e){console.log("Failed to get active element, skip scrolling")}}))})),await new Promise((e=>{(0,i.YP)((()=>n.songLyrics),e)})),a.value=n.songLyrics,a.value=e(a),a.value=a.value.reverse(),a.value=e(a),a.value.push({time:0,text:" "}),a.value=a.value.reverse(),console.log(a.value)})),(t,n)=>((0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",{class:"lyrics-container",ref_key:"lyricsContainer",ref:s},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.value,(t=>((0,i.wg)(),(0,i.iD)("div",{class:(0,l.C_)(["lyrics",{active:t.time===e.currentHighlight}]),key:t.time,onClick:e=>m(t),style:(0,l.j5)({fontSize:c(t)})},(0,l.zw)(t.text),15,u)))),128))],512)]))}},s=n(89);const c=(0,s.Z)(a,[["__scopeId","data-v-2d3cc0c1"]]);var v=c},1831:function(e,t,n){n.a(e,(async function(e,i){try{n.r(t);var l=n(4740),o=(n(7449),e([l]));l=(o.then?(await o)():o)[0];const r=l.Z;t["default"]=r,i()}catch(r){i(r)}}))},7449:function(){},4740:function(e,t,n){n.a(e,(async function(e,i){try{n.d(t,{Z:function(){return l.Z}});var l=n(7835),o=e([l]);l=(o.then?(await o)():o)[0],i()}catch(r){i(r)}}))}}]);
//# sourceMappingURL=831.c7b8f436.js.map